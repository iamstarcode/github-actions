name: Environment Variables & Secrets

on: push

env:
  GLOBAL_ENV: "I'm available in all jobs"
  LOG_LEVEL: "debug"

jobs:
  demo:
    runs-on: ubuntu-latest
    environment: production  # Access environment secrets
    
    env:
      JOB_ENV: "I'm available only in this job"
    
    steps:
      - name: Step with local env
        env:
          STEP_ENV: "I'm available only in this step"
        run: |
          echo "Global: $GLOBAL_ENV"
          echo "Job: $JOB_ENV"
          echo "Step: $STEP_ENV"
      
      - name: GitHub Context Variables
        run: |
          echo "Event: ${{ github.event_name }}"
          echo "Actor: ${{ github.actor }}"
          echo "Repository: ${{ github.repository }}"
          echo "Branch: ${{ github.ref }}"
          echo "Commit: ${{ github.sha }}"
          echo "Run: ${{ github.run_id }}"
      
      - name: Using Secrets (masked in logs)
        run: |
          echo "Username: ${{ secrets.DB_USERNAME }}"
          echo "Password: ${{ secrets.DB_PASSWORD }}"
          # Secrets are automatically masked in workflow logs
      
      - name: Safe Secret Usage
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          API_KEY: ${{ secrets.API_KEY }}
        run: |
          # Use environment variables instead of directly in run
          echo "Connected to database"
          # The actual secrets won't be printed
      
      - name: Output Variables for Next Steps
        id: vars
        run: |
          echo "version=1.0.0" >> $GITHUB_OUTPUT
          echo "timestamp=$(date)" >> $GITHUB_OUTPUT
      
      - name: Use Previous Step Output
        run: |
          echo "Version: ${{ steps.vars.outputs.version }}"
          echo "Timestamp: ${{ steps.vars.outputs.timestamp }}"
